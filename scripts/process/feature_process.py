from dataclasses import dataclass
from typing import Dict, List

import numpy
from shapely import ops
from shapely.geometry import LineString, Polygon


@dataclass
class RoomDataClass:
    id: int = None
    wkt: Polygon = None
    type: int = None


@dataclass
class PlanDataClass:
    name: str = None
    id: int = None
    wkt: Polygon = None
    main_entrance_wkt: LineString = None
    rooms: List[RoomDataClass] = None


@dataclass
class BedroomDim:
    width: int = None
    long: int = None
    centroid_position: numpy.array = None  # 重心相对位置


@dataclass
class FloorPlanGraph:
    '''
    此处除了客厅是相对于整体的户型的相对位置，其余的房间都是相对于客厅的相对位置,
    把这个写入到数据库中去
    '''
    id = None
    plan_graph_wl_dim = None
    plan_graph_area = 0
    plan_graph_name = ''
    bedroom_dim_list = [BedroomDim]  # 有多个
    livingroom_wl = None
    livingroom_position = None
    entrance_xy_dim = None  # 门的相对位置


class FeatureProcess:
    def __init__(self, query_result_row: Dict):
        '''
        :param query_result_row:  输入的是直接使从file——content 按字典读取出来的一行结果
        '''
        self.one_project = eval(query_result_row['content'])  # 可信的来源就直接这样转化了，json读取会报错，非常麻烦
        self.plan_obj = PlanDataClass()
        self.plan_obj.id = self.one_project.get("layout_unit").get("id")
        self.plan_obj.name = self.one_project.get("layout_unit").get("name")
        self.doors = self.one_project['layout_unit']['doors']
        self.nodes = self.one_project['layout_unit']['nodes']
        self.rooms = self.one_project['layout_unit']['rooms']
        self.walls = self.one_project['layout_unit']['walls']

    def __extract_wall_and_node_dict(self):
        self.wall_node_dict = {}
        for wall in self.walls:
            one_wall_node = []
            for node in self.nodes:
                if wall.get("source_id") == node.get("id") or wall.get("target_id") == node.get("id"):
                    one_wall_node.append([node['x'], node['y']])
            self.wall_node_dict[wall.get("id")] = one_wall_node

    def __extract_rooms_data(self):
        rooms_polygons = []
        for room in self.rooms:
            room_obj = RoomDataClass()

            room_obj.id = room['id']
            room_obj.type = room['room_type']

            some_line = []
            for wall_id in room['wall_id_list']:
                wall_nodes = self.wall_node_dict[wall_id]
                some_line.append(LineString(wall_nodes))
            one_room_line = ops.linemerge(some_line)
            one_room_polygon = Polygon(list(one_room_line.coords))
            room_obj.wkt = one_room_polygon
            rooms_polygons.append(room_obj)
        self.plan_obj.rooms = rooms_polygons

    def __fetch_main_enterance_wtk(self):
        for door in self.doors:
            if door['main_entrance'] == True:
                door_node = [[i['x'], i['y']] for i in door['coordinates']]
                door_wkt = LineString(door_node)
                self.plan_obj.main_entrance_wkt = door_wkt

    def __fetch_plan_total_wkt(self):
        plan_total = None
        for room_dataclass in self.plan_obj.rooms:
            if not plan_total:
                plan_total = room_dataclass.wkt
                continue
            plan_total = plan_total.union(room_dataclass.wkt)
        self.plan_obj.wkt = plan_total

    def extract_polygon(self):
        # 新的项目，一条就是一个layout_unit
        self.__extract_wall_and_node_dict()
        self.__extract_rooms_data()
        self.__fetch_main_enterance_wtk()
        self.__fetch_plan_total_wkt()

        print(self.plan_obj)

    def parse_to_plan_floor_graph(self):
        plan_floor_graph = FloorPlanGraph()
        plan_floor_graph.plan_graph_name = self.plan_obj.name
        plan_floor_graph.plan_graph_area = self.plan_obj.wkt.area/1e6  # 单位是毫米
        plan_floor_graph.





if __name__ == '__main__':
    row_data = {'id': '128433',
                'file_id': '163431',
                'file_type': 'RESIDENTIAL_UNIT',
                'content': '{\'version\': \'6\', \'layout_unit\': {\'id\': 6564, \'name\': \'3房1厅-94.79m²-竖厅-Nov10-6564\', \'doors\': [{\'id\': 57766, \'version\': \'6\', \'door_type\': 1, \'fireproof\': False, \'side_open\': False, \'coordinates\': [{\'x\': -1598.0, \'y\': -3400.0, \'version\': \'6\'}, {\'x\': -2498.0, \'y\': -3400.0, \'version\': \'6\'}], \'self_height\': 2000.0, \'door_leaf_num\': 1, \'main_entrance\': True, \'door_open_type\': 1, \'ground_clearance\': 0.0}, {\'id\': 57762, \'version\': \'6\', \'door_type\': 1, \'fireproof\': False, \'side_open\': False, \'coordinates\': [{\'x\': -1306.0, \'y\': -800.0, \'version\': \'6\'}, {\'x\': -2106.0, \'y\': -800.0, \'version\': \'6\'}], \'self_height\': 2000.0, \'door_leaf_num\': 1, \'main_entrance\': False, \'door_open_type\': 2, \'ground_clearance\': 0.0}, {\'id\': 57760, \'version\': \'6\', \'door_type\': 1, \'fireproof\': False, \'side_open\': False, \'coordinates\': [{\'x\': -2450.0, \'y\': -912.0, \'version\': \'6\'}, {\'x\': -2450.0, \'y\': -1612.0, \'version\': \'6\'}], \'self_height\': 2000.0, \'door_leaf_num\': 1, \'main_entrance\': False, \'door_open_type\': 2, \'ground_clearance\': 0.0}, {\'id\': 57765, \'version\': \'6\', \'door_type\': 1, \'fireproof\': False, \'side_open\': False, \'coordinates\': [{\'x\': 2000.0, \'y\': -2725.0, \'version\': \'6\'}, {\'x\': 2000.0, \'y\': -1925.0, \'version\': \'6\'}], \'self_height\': 2000.0, \'door_leaf_num\': 1, \'main_entrance\': False, \'door_open_type\': 3, \'ground_clearance\': 0.0}, {\'id\': 57761, \'version\': \'6\', \'door_type\': 1, \'fireproof\': False, \'side_open\': False, \'coordinates\': [{\'x\': -2200.0, \'y\': 81.0, \'version\': \'6\'}, {\'x\': -2200.0, \'y\': -519.0, \'version\': \'6\'}], \'self_height\': 2000.0, \'door_leaf_num\': 1, \'main_entrance\': False, \'door_open_type\': 3, \'ground_clearance\': 0.0}, {\'id\': 57764, \'version\': \'6\', \'door_type\': 4, \'fireproof\': False, \'side_open\': False, \'coordinates\': [{\'x\': 1225.0, \'y\': 2950.0, \'version\': \'6\'}, {\'x\': -875.0, \'y\': 2950.0, \'version\': \'6\'}], \'self_height\': 2000.0, \'door_leaf_num\': 2, \'main_entrance\': False, \'door_open_type\': 2, \'ground_clearance\': 0.0}, {\'id\': 57769, \'version\': \'6\', \'door_type\': 1, \'fireproof\': False, \'side_open\': False, \'coordinates\': [{\'x\': 3100.0, \'y\': -219.0, \'version\': \'6\'}, {\'x\': 3100.0, \'y\': -819.0, \'version\': \'6\'}], \'self_height\': 2000.0, \'door_leaf_num\': 1, \'main_entrance\': False, \'door_open_type\': 1, \'ground_clearance\': 0.0}, {\'id\': 57768, \'version\': \'6\', \'door_type\': 1, \'fireproof\': False, \'side_open\': False, \'coordinates\': [{\'x\': 2056.0, \'y\': -50.0, \'version\': \'6\'}, {\'x\': 2856.0, \'y\': -50.0, \'version\': \'6\'}], \'self_height\': 2000.0, \'door_leaf_num\': 1, \'main_entrance\': False, \'door_open_type\': 1, \'ground_clearance\': 0.0}, {\'id\': 57767, \'version\': \'6\', \'door_type\': 1, \'fireproof\': False, \'side_open\': False, \'coordinates\': [{\'x\': 5681.0, \'y\': -1750.0, \'version\': \'6\'}, {\'x\': 4881.0, \'y\': -1750.0, \'version\': \'6\'}], \'self_height\': 2000.0, \'door_leaf_num\': 1, \'main_entrance\': False, \'door_open_type\': 2, \'ground_clearance\': 0.0}, {\'id\': 57763, \'version\': \'6\', \'door_type\': 1, \'fireproof\': False, \'side_open\': False, \'coordinates\': [{\'x\': 2000.0, \'y\': -1300.0, \'version\': \'6\'}, {\'x\': 2000.0, \'y\': -200.0, \'version\': \'6\'}], \'self_height\': 2000.0, \'door_leaf_num\': 1, \'main_entrance\': False, \'door_open_type\': 3, \'ground_clearance\': 0.0}], \'lifts\': [], \'nodes\': [{\'x\': -1250.0, \'y\': -800.0, \'id\': 202137, \'version\': \'6\'}, {\'x\': -4100.0, \'y\': 4300.0, \'id\': 202136, \'version\': \'6\'}, {\'x\': -5750.0, \'y\': -3400.0, \'id\': 202135, \'version\': \'6\'}, {\'x\': -2450.0, \'y\': -3400.0, \'id\': 202134, \'version\': \'6\'}, {\'x\': -5750.0, \'y\': 250.0, \'id\': 202133, \'version\': \'6\'}, {\'x\': 2000.0, \'y\': 3250.0, \'id\': 202132, \'version\': \'6\'}, {\'x\': 2000.0, \'y\': 2950.0, \'id\': 202131, \'version\': \'6\'}, {\'x\': 4550.0, \'y\': 650.0, \'id\': 202130, \'version\': \'6\'}, {\'x\': 4650.0, \'y\': 650.0, \'id\': 202129, \'version\': \'6\'}, {\'x\': 4650.0, \'y\': 3250.0, \'id\': 202128, \'version\': \'6\'}, {\'x\': 2000.0, \'y\': -3400.0, \'id\': 202127, \'version\': \'6\'}, {\'x\': 5850.0, \'y\': -3400.0, \'id\': 202126, \'version\': \'6\'}, {\'x\': -4100.0, \'y\': -800.0, \'id\': 202125, \'version\': \'6\'}, {\'x\': -2450.0, \'y\': -800.0, \'id\': 202124, \'version\': \'6\'}, {\'x\': -2200.0, \'y\': -800.0, \'id\': 202123, \'version\': \'6\'}, {\'x\': -2200.0, \'y\': 1150.0, \'id\': 202122, \'version\': \'6\'}, {\'x\': -4100.0, \'y\': 1150.0, \'id\': 202121, \'version\': \'6\'}, {\'x\': -4100.0, \'y\': 250.0, \'id\': 202120, \'version\': \'6\'}, {\'x\': -1250.0, \'y\': 4300.0, \'id\': 202119, \'version\': \'6\'}, {\'x\': -1250.0, \'y\': 2950.0, \'id\': 202118, \'version\': \'6\'}, {\'x\': 1450.0, \'y\': 2950.0, \'id\': 202117, \'version\': \'6\'}, {\'x\': 1450.0, \'y\': 4300.0, \'id\': 202116, \'version\': \'6\'}, {\'x\': 4550.0, \'y\': -1750.0, \'id\': 202115, \'version\': \'6\'}, {\'x\': 5850.0, \'y\': -1750.0, \'id\': 202114, \'version\': \'6\'}, {\'x\': 5850.0, \'y\': -50.0, \'id\': 202113, \'version\': \'6\'}, {\'x\': 4550.0, \'y\': -50.0, \'id\': 202112, \'version\': \'6\'}, {\'x\': 2000.0, \'y\': -1750.0, \'id\': 202111, \'version\': \'6\'}, {\'x\': 3100.0, \'y\': -1750.0, \'id\': 202110, \'version\': \'6\'}, {\'x\': 3100.0, \'y\': -50.0, \'id\': 202109, \'version\': \'6\'}, {\'x\': 2000.0, \'y\': -50.0, \'id\': 202108, \'version\': \'6\'}], \'rooms\': [{\'id\': 55655, \'version\': \'6\', \'area_mode\': 1, \'room_type\': 13, \'wall_id_list\': [251221, 251223, 251222, 251209]}, {\'id\': 55654, \'version\': \'6\', \'area_mode\': 2, \'room_type\': 10, \'wall_id_list\': [251210, 251215, 251221, 251214]}, {\'id\': 55653, \'version\': \'6\', \'area_mode\': 2, \'room_type\': 1, \'wall_id_list\': [251220, 251219, 251203, 251218, 251217, 251216, 251215, 251213]}, {\'id\': 55652, \'version\': \'6\', \'area_mode\': 2, \'room_type\': 35, \'wall_id_list\': [251214, 251213, 251208, 251200]}, {\'id\': 55651, \'version\': \'6\', \'area_mode\': 2, \'room_type\': 7, \'wall_id_list\': [251202, 251212, 251211, 251210, 251209, 251208]}, {\'id\': 55650, \'version\': \'6\', \'area_mode\': 1, \'room_type\': 13, \'wall_id_list\': [251207, 251195, 251201, 251206]}, {\'id\': 55649, \'version\': \'6\', \'area_mode\': 2, \'room_type\': 4, \'wall_id_list\': [251205, 251204, 251199, 251198, 251188, 251203, 251202, 251194, 251201, 251200]}, {\'id\': 55648, \'version\': \'6\', \'area_mode\': 2, \'room_type\': 3, \'wall_id_list\': [251199, 251198, 251197, 251196, 251193, 251192, 251195]}, {\'id\': 55647, \'version\': \'6\', \'area_mode\': 2, \'room_type\': 9, \'wall_id_list\': [251186, 251185, 251194, 251193, 251192, 251191]}, {\'id\': 55646, \'version\': \'6\', \'area_mode\': 2, \'room_type\': 2, \'wall_id_list\': [251190, 251189, 251188, 251187, 251186, 251185]}], \'walls\': [{\'id\': 251205, \'version\': \'6\', \'source_id\': 202117, \'target_id\': 202131, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251204, \'version\': \'6\', \'source_id\': 202127, \'target_id\': 202134, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251199, \'version\': \'6\', \'source_id\': 202137, \'target_id\': 202123, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251198, \'version\': \'6\', \'source_id\': 202118, \'target_id\': 202137, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251197, \'version\': \'6\', \'source_id\': 202136, \'target_id\': 202119, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251196, \'version\': \'6\', \'source_id\': 202121, \'target_id\': 202136, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251190, \'version\': \'6\', \'source_id\': 202135, \'target_id\': 202133, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251189, \'version\': \'6\', \'source_id\': 202134, \'target_id\': 202135, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251188, \'version\': \'6\', \'source_id\': 202124, \'target_id\': 202134, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251187, \'version\': \'6\', \'source_id\': 202133, \'target_id\': 202120, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251220, \'version\': \'6\', \'source_id\': 202132, \'target_id\': 202128, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251219, \'version\': \'6\', \'source_id\': 202131, \'target_id\': 202132, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251203, \'version\': \'6\', \'source_id\': 202108, \'target_id\': 202131, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251218, \'version\': \'6\', \'source_id\': 202130, \'target_id\': 202112, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251217, \'version\': \'6\', \'source_id\': 202129, \'target_id\': 202130, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251216, \'version\': \'6\', \'source_id\': 202128, \'target_id\': 202129, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251202, \'version\': \'6\', \'source_id\': 202127, \'target_id\': 202111, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251212, \'version\': \'6\', \'source_id\': 202126, \'target_id\': 202127, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251211, \'version\': \'6\', \'source_id\': 202114, \'target_id\': 202126, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251186, \'version\': \'6\', \'source_id\': 202125, \'target_id\': 202120, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251185, \'version\': \'6\', \'source_id\': 202124, \'target_id\': 202125, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251194, \'version\': \'6\', \'source_id\': 202123, \'target_id\': 202124, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251193, \'version\': \'6\', \'source_id\': 202122, \'target_id\': 202123, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251192, \'version\': \'6\', \'source_id\': 202121, \'target_id\': 202122, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251191, \'version\': \'6\', \'source_id\': 202120, \'target_id\': 202121, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251207, \'version\': \'6\', \'source_id\': 202119, \'target_id\': 202116, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251195, \'version\': \'6\', \'source_id\': 202118, \'target_id\': 202119, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251201, \'version\': \'6\', \'source_id\': 202117, \'target_id\': 202118, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251206, \'version\': \'6\', \'source_id\': 202116, \'target_id\': 202117, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251210, \'version\': \'6\', \'source_id\': 202115, \'target_id\': 202110, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251215, \'version\': \'6\', \'source_id\': 202109, \'target_id\': 202112, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251221, \'version\': \'6\', \'source_id\': 202115, \'target_id\': 202112, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251223, \'version\': \'6\', \'source_id\': 202113, \'target_id\': 202114, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251222, \'version\': \'6\', \'source_id\': 202112, \'target_id\': 202113, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251214, \'version\': \'6\', \'source_id\': 202109, \'target_id\': 202110, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251213, \'version\': \'6\', \'source_id\': 202108, \'target_id\': 202109, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251209, \'version\': \'6\', \'source_id\': 202114, \'target_id\': 202115, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251208, \'version\': \'6\', \'source_id\': 202110, \'target_id\': 202111, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}, {\'id\': 251200, \'version\': \'6\', \'source_id\': 202111, \'target_id\': 202108, \'wall_type\': 1, \'wall_shape\': 1, \'self_height\': 1000.0, \'shared_wall\': False, \'wall_shape_params\': {\'path\': None, \'control_points\': None}, \'core_thickness_left\': 100.0, \'core_thickness_right\': 100.0, \'thermal_layer_thickness_left\': 0.0, \'thermal_layer_thickness_right\': 0.0}], \'version\': \'6\', \'windows\': [{\'id\': -1607499968618202, \'version\': \'6\', \'fireproof\': False, \'coordinates\': [{\'x\': -3369.0, \'y\': 4300.0, \'version\': \'6\'}, {\'x\': -1850.0, \'y\': 4300.0, \'version\': \'6\'}], \'self_height\': 400.0, \'window_type\': 1, \'ground_clearance\': 200.0}, {\'id\': -1607499968618204, \'version\': \'6\', \'fireproof\': False, \'coordinates\': [{\'x\': -5244.0, \'y\': 250.0, \'version\': \'6\'}, {\'x\': -4220.0, \'y\': 250.0, \'version\': \'6\'}], \'self_height\': 400.0, \'window_type\': 1, \'ground_clearance\': 200.0}, {\'id\': -1607499968618205, \'version\': \'6\', \'fireproof\': False, \'coordinates\': [{\'x\': 2281.0, \'y\': 3250.0, \'version\': \'6\'}, {\'x\': 4024.0, \'y\': 3250.0, \'version\': \'6\'}], \'self_height\': 400.0, \'window_type\': 1, \'ground_clearance\': 200.0}, {\'id\': -1607499968618208, \'version\': \'6\', \'fireproof\': False, \'coordinates\': [{\'x\': -4100.0, \'y\': 306.0, \'version\': \'6\'}, {\'x\': -4100.0, \'y\': 644.0, \'version\': \'6\'}], \'self_height\': 400.0, \'window_type\': 1, \'ground_clearance\': 200.0}, {\'id\': -1607499968618209, \'version\': \'6\', \'fireproof\': False, \'coordinates\': [{\'x\': -1194.0, \'y\': 4300.0, \'version\': \'6\'}, {\'x\': 1224.0, \'y\': 4300.0, \'version\': \'6\'}], \'self_height\': 400.0, \'window_type\': 1, \'ground_clearance\': 200.0}, {\'id\': -1607499968618211, \'version\': \'6\', \'fireproof\': False, \'coordinates\': [{\'x\': 4550.0, \'y\': -850.0, \'version\': \'6\'}, {\'x\': 4550.0, \'y\': -232.0, \'version\': \'6\'}], \'self_height\': 400.0, \'window_type\': 1, \'ground_clearance\': 200.0}, {\'id\': -1607499968618212, \'version\': \'6\', \'fireproof\': False, \'coordinates\': [{\'x\': 4607.0, \'y\': -50.0, \'version\': \'6\'}, {\'x\': 5675.0, \'y\': -50.0, \'version\': \'6\'}], \'self_height\': 400.0, \'window_type\': 1, \'ground_clearance\': 200.0}], \'stairways\': [], \'created_at\': 0, \'furnitures\': [], \'updated_at\': 0, \'bay_windows\': [], \'description\': \'{"area": 74.0, "lng": "106.57272", "lat": "29.495461", "loupan_name": "\\\\u4e07\\\\u79d1\\\\u91d1\\\\u57df\\\\u5b66\\\\u5e9c", "project_use": "\\\\u4f4f\\\\u5b85", "project_parking": "\\\\u5730\\\\u4e0a\\\\u8f66\\\\u4f4d\\\\u65702378\\\\uff1b\\\\u5730\\\\u4e0b\\\\u8f66\\\\u4f4d\\\\u6570188", "project_water": "\\\\u6c11\\\\u6c34", "project_site_area": "250,000\\\\u33a1", "project_far": "3.46", "project_green": "31%", "project_manag_fee_unit": "3~3.8\\\\u5143/m\\\\u00b2/\\\\u6708", "project_heat": "\\\\u81ea\\\\u91c7\\\\u6696", "project_power": "\\\\u6c11\\\\u7535", "project_built_area": "1,050,000\\\\u33a1", "zfang_unit_price_avg_recent": "\\\\u4ef7\\\\u683c\\\\u5f85\\\\u5b9a", "project_unit_price_record": "155\\\\u5929", "project_address": "\\\\u5357\\\\u6ee8\\\\u897f\\\\u8def33\\\\u53f7", "project_open_year": "2019.05", "project_news": ["2020-9-30-\\\\u4ea4\\\\u623f-\\\\u7ff0\\\\u6797\\\\u4e8c\\\\u671fG2\\\\u53f7\\\\u697c,\\\\u7ff0\\\\u6797\\\\u4e8c\\\\u671fG3\\\\u53f7\\\\u697c,\\\\u7ff0\\\\u6797\\\\u4e8c\\\\u671f5\\\\u680b,\\\\u7ff0\\\\u6797\\\\u4e8c\\\\u671f9\\\\u680b,\\\\u7ff0\\\\u6797\\\\u4e8c\\\\u671f10\\\\u680b,\\\\u7ff0\\\\u6797\\\\u4e8c\\\\u671f\\\\u6d0b\\\\u623f6\\\\u53f7\\\\u697c", "2018-4-28-\\\\u5f00\\\\u76d8-\\\\u7ff0\\\\u6797\\\\u4e8c\\\\u671fG2\\\\u53f7\\\\u697c,\\\\u7ff0\\\\u6797\\\\u4e8c\\\\u671fG3\\\\u53f7\\\\u697c,\\\\u7ff0\\\\u6797\\\\u4e8c\\\\u671f5\\\\u680b", "2017-12-2-\\\\u5f00\\\\u76d8-\\\\u7ff0\\\\u6797\\\\u4e8c\\\\u671f10\\\\u680b", "2017-7-31-\\\\u5f00\\\\u76d8-\\\\u7ff0\\\\u6797\\\\u4e8c\\\\u671f9\\\\u680b,\\\\u7ff0\\\\u6797\\\\u4e8c\\\\u671f\\\\u6d0b\\\\u623f6\\\\u53f7\\\\u697c"]}\', \'slab_components\': [], \'furniture_groups\': [], \'layout_unit_type\': 1, \'column_components\': [], \'lighting_face_direction\': 2}}'}
    feature_process = FeatureProcess(row_data)
    feature_process.extract_polygon()
